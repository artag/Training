# Легковес

*Также известен как*: Приспособленец, Кэш, Flyweight

*Сложность*: 3/3

*Популярность*: 1/3

**Легковес** - это структурный паттерн, который экономит память, благодаря
разделению общего состояния, вынесенного в один объект, между множеством объектов.

Легковес позволяет экономить память, кешируя одинаковые данные,
используемые в разных объектах.

## Структура

![Структура1](./images/flyweight.png)

1. Вы всегда должны помнить о том, что Легковес применяется в программе, имеющей громадное
количество одинаковых объектов. Этих объектов должно быть так много, чтобы они не
помещались в доступную оперативную память без ухищрений.
Паттерн разделяет данные этих объектов на две части - легковесы и контексты.

2. **Легковес** содержит состояние, которое повторялось во множестве первоначальных объектов.
Один и тот же легковес можно использовать в связке со множеством контекстов.
Состояние, которое хранится здесь, называется внутренним, а то,
которое он получает извне - внешним.

3. **Контекст** содержит «внешнюю» часть состояния, уникальную для каждого объекта.
Контекст связан с одним из объектов-легковесов, хранящих оставшееся состояние.

4. Поведение оригинального объекта чаще всего оставляют в Легковесе, передавая
значения контекста через параметры методов. Тем не менее, поведение можно поместить
и в контекст, используя легковес как объект данных.

5. **Клиент** вычисляет или хранит контекст, то есть внешнее состояние легковесов.
Для клиента легковесы выглядят как шаблонные объекты, которые можно настроить
во время использования, передав контекст через параметры.

6. **Фабрика легковесов** управляет созданием и повторным использованием легковесов.
Фабрика получает запросы, в которых указано желаемое состояние легковеса.
Если легковес с таким состоянием уже создан, фабрика сразу его возвращает,
а если нет - создаёт новый объект.

![Структура2](./images/flyweight_uml.png)

## Применимость

1. Когда не хватает оперативной памяти для поддержки всех нужных объектов.

2. Эффективность паттерна Легковес во многом зависит от того, как и где он используется.
Применяйте этот паттерн, когда выполнены все перечисленные условия:

* в приложении используется большое число объектов;

* из-за этого высоки расходы оперативной памяти;

* большую часть состояния объектов можно вынести за пределы их классов;

* большие группы объектов можно заменить относительно небольшим количеством разделяемых объектов,
поскольку внешнее состояние вынесено.

## Признаки применения паттерна

Легковес можно определить по создающим методам класса,
которые возвращают закешированные объекты, вместо создания новых.
