# Заметки

## Миграции в Entity Framework (из книги)

### Пример создания миграции для `Orders`.
(`Orders` является свойством класса `*DbContext`.
Повторить для всех подобных свойств класса `*DbContext`).

Для создания миграции выполнить в командной строке или PowerShell из директории текущего проекта:
```
dotnet ef migrations add Orders
```

Если в модель приходится часто вносить изменения, то может возникнуть ситуация, когда миграции и схема
базы данных перестают быть синхронизированными. Самое простое, что можно сделать - удалить
базу данных и начать заново. Однако, такой подход приемлем только на стадии разработки, потому что
все сохраненные данные будут утрачены.

Чтобы удалить базу данных, необходимо ввести команду, находясь в папке текущего проекта:
```
dotnet ef database drop --force
```

После того, как база данных удалена, ввод следующей команды в папке проекта приводит к построению
базы данных заново и применению созданных ранее миграций:
```
dotnet ef database update
```

В результате база данных переустанавливается, точно отражая модель, что дает возможность возвратиться
к разработке приложения.


### Пример добавления нового свойства в `Orders`
Добавляется новое свойство `public bool Shipped { get; set; }`

Чтобы добавить это свойство в миграцию БД, в таблицу `Order` надо 
ввести команду, находясь в папке текущего проекта: 
```
dotnet ef migrations add ShippedOrders
```

Миграция будет применена автоматически, когда приложение запустится и в классе `SeedData`
произойдет обращение к методу `Migrate()`.


### Миграция для базы данных `Identity`
Создание новой миграции для базы данных `Identity`:
```
dotnet ef migrations add Initial --context AppIdentityDbContext
```

`--context` используется для указания имени класса контекста, ассоциированного с базой данных,
с которой необходимо работать.

Создание новой базы данных и запуск программы миграции:
```
dotnet ef database update --context AppIdentityDbContext
```
