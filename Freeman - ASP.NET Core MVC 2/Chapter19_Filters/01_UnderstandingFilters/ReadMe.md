# Использование фильтров

Фильтры внедряют дополнительную логику в процесс обработки запросов MVC и предлагают простой
способ реализации *сквозной обязанности*.

Классические примеры сквозной обязанности: регистрация в журнале, авторизация и кеширование.

Фильтры можно применять на уромне методов и на уровне классов.
Если нужно применить какой-либо фильтр к любому действию в приложении, то можно использовать
*глобальные фильтры* (см. далее в главе).

В `Controllers/HomeController` используется фильтр `RequireHttps`.
Этот фильтр ограничивает доступ к методам действий - поддерживаются только запросы `https`.
Это позволяет удалить из методов соответствующие проверки.

Фильтр `RequireHttps` перенаправляет с адреса `http` на `https`.

В `Controllers/NoFiltersController` приведен пример "ручной" реализации ограничения доступа по http:
если запрос не `https`, то возвращается код 403 (Forbidden).


Проверка работы. Для Rider:
`http://localhost:5000`
`https://localhost:5001`


## Понятие фильтров. Виды фильтров

Фильтры реализуют интерфейс `IFilterMetadata`. Этот интерфейс пуст, т.к. существуют фильтры различных
типов:

* Фильтры авторизации.
`IAuthorizationFilter`, `IAsyncAuthorizationFilter`
Применение политики безопасности приложения, включая авторизацию пользователей.

* Фильтры действий.
`IActionFilter`, `IAsyncResultFilter`
Выполнение работы немедленно до или после выполнения метода действия.

* Фильтры результатов.
`IResultFilter`, `IAsyncResultFilter`
Выполнение работы немедленно до или после обработки результата, полученного после из метода действия.

* Фильтры исключений.
`IExceptionFilter`, `IAsyncExceptionFilter`
Обработка исключений.

Фильтры применяются в особом порядке:
1. Фильтры авторизации
2. Фильтры действий
3. Фильтры результатов

Фильтры исключений выполняются только при генерации какого-либо исклюлчения.


## Получение данных контекста

`FilterContext` (производный от `ActionContext`) - данные контекста.

Свойства `FilterContext`:
* `ActionDescriptor`- Объект `ActionDescriptor`. Описывает метод действия.

* `HttpContext`- Объект `HttpContext`. Предоставляет детали HTTP-запроса и HTTP-ответа.

* `ModelState`- Объект `ModelStateDictionary`. Используется для проверки достоверности данных,
отправленных клиентом.

* `RouteData`- Объект `RouteData`. Описывает способ обработки запроса системой маршрутизации.

* `Filters`- Объект `IList<IFilterMetadata>`. Список фильтров, которые были применены к методу
действия.
