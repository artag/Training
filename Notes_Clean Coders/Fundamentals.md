# Clean Code. Fundamentals

## Episode 1. Clean Code

### Does Clean Code Matter?

Чистый код имеет очень большое значение при долговременной разработке и поддержке больших
и сложных программных продуктов.

### The Productivity Trap (ловушка)

Productivity vs Time

![Productivity vs Time](images/ep01_productivity_vs_time.png "Productivity vs Time")

Чем сложнее продукт, тем:

* Требуется все больше и больше времени на внедрение новых фич.
* Требуется все больше и больше времени на исправление багов.
* Затраты на разработку увеличиваются.
* Найм новых сотрудников не спасает (даже ухудшает) положение.

### The Big Redesign in the Sky

Переписывание продукта с нуля скорее всего не спасет положение:

* Старый продукт постоянно развивается - надо развивать также переписываемый продукт.
* Отсюда, новый продукт может не поддерживать какие-то фичи старого.

Переписывание программы может сработать для несложного и молодого продукта.

### Code Rot (протухание кода)

#### Rigidity (отсутствие гибкости)

Система сопротивляется изменениям.

Каждое изменение кода начинает приводить к новым багам в самых разных частях программного продукта.

Исправление бага вместо одного дня занимает несколько недель.

#### Fragility (хрупкость)

Поведение кода становится непредсказуемым после любого изменения.

Изменение в одном месте ПО, может изменить/сломать функционал в совершенно другом месте.

#### Inseparability (неделимость)

Невозможность переиспользования функционала в других частях, при разработке другого ПО.

#### Opacity (непрозрачность)

Сложночитаемый код ухудшает его поддержку.

#### Why does code Rot? (Почему код становится грязным?)

Дедлайны, откладывание "причесывания" кода на "когда-нибудь потом".
Естественно, что "когда-нибудь потом" никогда не наступает.

### The Boy Scout Rule

Оставляйте после себя место чище, чем оно было до вас.
После каждого изменения кода, старайтесь делать код вокруг чуть чище.

## Episode 2. Names

### Reveal Your Intent (Раскрывайте свои намерения)

* Если для имени требуется комментарий, то значит выбрано плохое имя.

*Плохо:*

```java
int d; // elapsed time in days;
```

*Хорошо:*

```java
int elapsedTimeInDays;
```

### Describe The Problem

* Если приходится лезть в код, где используется имя, чтобы узнать зачем оно нужно или о чем оно,
значит это плохое имя.

* Always choose names to communicate your intent. (Всегда выбирайте такие имена, чтобы сообщать о
своих намерениях.)

*Пример.* Непонятно, что это. И комментарий непонятен:

```java
/** Useful range constant. **/
public static final int INCLUDE_NONE = 0;

/** Useful range constant. **/
public static final int INCLUDE_FIRST = 1;

/** Useful range constant. **/
public static final int INCLUDE_SECOND = 2;

/** Useful range constant. **/
public static final int INCLUDE_BOTH = 3;
```

Лучше назвать эти константы (это интервалы) как-то так:

```text
Intervals!
(a, b) open
[a, b] closed
(a, b] open left
[a, b) open right
```

... и сделать такой enum:

```java
public enum DateInterval {
    OPEN,
    CLOSED,
    OPEN_LEFT,
    OPEN_RIGHT
}
```

### Avoid Disinformation

*Пример 1.* Неясное имя, которое ничего не разъясняет, а только путает.

```java
public abstract class SerialDate
```

Непонятно что такое "Serial", как оно применяется к "Date".

*Пример 2.* Неточное имя функции, параметра.

```java
public static String[] getMonths(final boolean shortened) {
    if (shortened) {
        return DATE_FORMAT_SYMBOLS.getShortMonths();
    }
    else {
        return DATE_FORMAT_SYMBOLS.getMonths();
    }
}
```

* Эта функция возвращает имена месяцев, но по ее имени это непонятно.
* Правильное ее название должно быть `getMonthNames`
* Параметр `shortened` также назван неправильно. Правильней было бы назвать `shortenedName`.
* Плюс, передача `bool` параметра это плохо (почему? - см. след. эпизоды).

*Пример 3.* Ошибка. Имя вообще означает не то, что описывает.

```java
public class Pair
{
    // ...
    public Pair(Object first, Object second, Object third)
    {
        // ...
    }
    // ...
}
```

### Pronounceable Names

* Имена должны быть произносимыми.
* Имена - инструменты для коммуникации, делайте их понятными для других.

*Примеры.* Как произнести это всё?

```text
PC-GWDA                     // Что это?
```

```java
public int getYYYY() {      // getYYYY?    Лучше назвать getYear.
    return this.year
}
```

```java
try {
    m_qdox.addSource(f);        // m_qdox - префиксы необязательны, имя невнятное
}
catch(ParseException e) {
    ppp("Cannot parse file "    // ppp?
}
```

Плохие имена для переменных:

```java
int qty_tests = 0;
int qty_pass_m = 0;
int qty_pass_s = 0;
int qty_skip = 0;
int qty_fail = 0;
```

### Avoid Encodings

* Избегайте зашифрованные имена.

* Избегайте префиксов, обозначающих тип данных. Сейчас IDE может показать тип данных для любой
переменной.

* Компилятор и Unit тесты позволяют избежать неправильного использования переменной, метода, класса.

* Просто используйте имена.

*Примеры* ненужных префиксов. (*Мое примечание: некоторые моменты здесь спорны*)

Prefix| Type                       | Example                        |
------|----------------------------|--------------------------------|
C     | Class                      | `CAccount`                     |
I     | Interface                  | `IAccount`                     |
p     | pointer                    | `pAccount`                     |
s     | string                     | `sName`                        |
sz    | null terminated            | `szName`                       |
psz   | pointer to null terminated | `pszName`                      |

### Parts of Speech

#### Именование классов и переменных

Классы и переменные - *существительные* (nouns)

*Примеры* имен классов/переменных: `Account`, `MessageParser`

* **Игнорируйте** слова, которые "создают шум": `Manager`, `Processor`, `Data`, `Info`.

#### Именование методов

Методы - *глаголы* (verbs)

*Примеры* имен методов:

```java
postPayment(payment);
Money price = getPrice();
```

#### Экземляры классов

Экземляры классов - *существительные* (nouns)

Экземляры классов часто повторяют имя класса, объектами которых они являются.

#### Bool переменные и методы, которые возвращают bool

`bool` переменная должна быть записана как *predicate*.

*Примеры*:

```java
boolean isEmpty;
boolean isTerminated;
```

Все это для того, чтобы `bool` переменная хорошо читалась с `if`:

```java
if (isEmpty) {
    if (Payment.isPostable())
        postPayment(payment);
}
```

Методы, которые возвращают `bool`, также должны быть названы как *predicate*.
Тоже для комфортного чтения с `if`:

```java
if (Payment.isPostable()) { 
    // ...
}
```

#### Свойства (из C#)

Свойства должны быть *существительные* (nouns).

Если свойство `bool`, то должно быть названо как *predicate*.

#### Enums

Перечисления должны быть названы как *прилагательные* (adjectives).

Пример:

```java
enum Color { RED, GREEN, BLUE };
enum Status { PENDING, CLOSED, CANCELLED };
enum Size { SMALL, MEDIUM, LARGE };
```

### The Scope Length Rule

* Переменные, которые имеют большой scope, должны иметь длинное имя.
* Переменные, которые имеют малый scope, могут иметь короткое имя. Даже аббревиатуру или вообще,
состоять из одного символа.
* Публичные методы/функции с большим scope, должны иметь короткие convenient (комфортные/удачные)
имена.
* Private методы/функции с малым scope, должны иметь длинные говорящие имена.
* Публичные классы с большим scope, должны иметь короткие convenient (комфортные/удачные) имена.
* Private nested классы с малым scope, должны иметь длинные говорящие имена.
* Будьте внимательны с унаследованными классами с большим scope: они добавляют прилагательное
к существительному и также не должны иметь слишком большую длину.

*Пример* унаследованного класса:

```java
// Базовый класс
Account

// Класс-наследник
SavingsAccount
```

### Recap & Conclusion

1. Choose your names thoughtfully (вдумчиво).
2. Communicate your intent. (Сообщайте о своем намерении.)
3. Avoid Disinformation
  * Не позволяйте именам быть "грязными".
  * Не позволяйте смыслу быть размытым.
  * Имя должно соответствовать своему назначению.
4. Pronounceable Names
  * Используйте произвносимые имена
5. Avoid encodings
  * Избегайте сокращений
  * Избегайте префиксов
6. Choose Parts of Speech Well.
  * Классы, переменные - существительные
  * Методы - глаголы
  * bool - предикаты
7. The Scope Rule
  * Переменные, которые имеют большой scope, должны иметь длинное имя.
  * Переменные, которые имеют малый scope, могут иметь короткое имя (даже 1 символ).
  * Публичные методы/функции/классы с большим scope, должны иметь короткие имена.
  * Private методы/функции/классы с малым scope, должны иметь длинные говорящие имена.
